---
title: Create and deploy a User Define Function (UDF)
layout: function
isPage: true
category: howto
---

A UDF corresponds to a custom Java class defined by a user. A UDF can easily be added to a [Warp 10 platform](http://www.warp10.io/).

In this page, you will learn how to implement a UDF and how to deploy a new UDF in your own platform. The goal of this "tutorial" UDF is to create a single string from 2 strings that are currently on top of the stack.

The full code is available on github [here](https://github.com/aurrelhebert/warp10-udf-tuto).

## UDF Interface

The Java function defining out UDF has to implement the `WarpScriptRawJavaFunction` interface.
 
You UDF class must then implement the function `apply` which will be called when your UDF is invoked.

Additionally, your UDF can implement the method `isProtected` which returns a boolean indicating whether your UDF can be invoked from anywhere (`false`) or only from within server side macros or secure scripts (`true`)

## Getting started

First of all, create a new Gradle project in your favorite IDE, and add a new package in src/main/java: `io.warp10.tutorial`.

Then create the class HELLOWARP10 that implements `WarpScriptRawJavaFunction`.

Use this [file]({{ site.baseurl }}/assets/data/build.gradle) as build.gradle. 

Inside the `build.gradle` file, notice that it doesn't include in the generated jar the WarpScript library. Instead it indicates that this library is needed at execution time. This is done by declaring the following in `build.gradle`:

```
provided 'io.warp10:warpscript:1.2.4'
```

This operation is important because it means the UDF doesn't need to be recompiled for each new Warp 10 version as **it will dynamically use the current version** available on your Warp 10 deployment.

## The Apply function

In this function, first we retrieve the current stack from the parameter.

```
WarpScriptStack stack =(WarpScriptStack) arg0.get(0);
```

Then we extract the top two parameters.

```
Object firstText = stack.pop();
Object secondText = stack.pop();
```

We check if both parameters are valid (if they are String it's enough for this example).

```
if (!(firstText instanceof String)) {
  throw new WarpScriptJavaFunctionException("First param must be a String");
  //throw new WarpScriptJavaFunctionException();
}
```

Finally we push back a new element on the stack which is the concatenation of both string.

```
stack.push(firstText.toString() + ' ' + secondText.toString());
...
return arg0;
```

The object returned by the function is arg0 (which contain the updated stack).

## Deploy it

First compile this project.

```
gradle shadowJar
```

Open the Warp 10 conf file. Then configure both following parameters to access some udf. Then copy the jar generated by gradle in warpscript.jars.directory.

```
warpscript.jars.directory = /some/dir/udf
warpscript.jars.refresh = 60000
```

## Use your UDF

To execute it just run the following WarpScript on your Warp 10 backend.

```
    'WARP 10' 'HELLO'
    'io.warp10.tutorial.HELLOWARP10' UDF
```

Congrats you managed to create your first UDF for Warp 10.

The above example used the `UDF` function to invoke your UDF, this function will create a new instance of your UDF at each invocation. You may instead want to use `CUDF` which will cache (hence the leading `C`) the created instance and thus will speed up overall execution.

Of course if your UDF is not thread safe then it should not be called by `CUDF`, but as this is not something you can control, we advise that you design your UDFs so they can be called concurrently from multiple threads.
