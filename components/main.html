<link rel="import" href="./styles.html">
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="app-route/app-location.html">
<link rel="import" href="app-route/app-route.html">
<link rel="import" href="iron-pages/iron-pages.html">
<link rel="import" href="iron-scroll-target-behavior/iron-scroll-target-behavior.html">
<link rel="import" href="marked-element/marked-element.html">
<link rel="import" href="landing.html">
<link rel="import" href="layout.html">
<link rel="import" href="nav.html">
<link rel="import" href="footer.html">
<dom-module id="warp10-main">

  <template>
    <style include="style-module">

      :host {
        display: block;
      }
    </style>
    <warp10-nav show="[[isOnTop]]" path="[[path]]"></warp10-nav>

    <div class="page-wrap">
      <app-route
        route="{{route}}"
        pattern="/:view"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>
      <app-location route="{{route}}" use-hash-as-path></app-location>
      <iron-pages selected="[[routeData.view]]"
                  attr-for-selected="name"
                  role="main"
                  fallback-selection="landing">
        <warp10-landing name="landing" route="{{subroute}}"></warp10-landing>
        <warp10-layout name="nav" route="{{subroute}}" with-menu="[[false]]"></warp10-layout>
        <warp10-layout name="doc" route="{{subroute}}" with-menu></warp10-layout>
      </iron-pages>

    </div>
    <warp10-footer></warp10-footer>
  </template>
  <script>
    class Warp10Main extends Polymer.mixinBehaviors([Polymer.IronScrollTargetBehavior], Polymer.Element) {
      static get is() {
        return 'warp10-main'
      }

      static get properties() {
        return {
          isOnTop: {
            type: Boolean,
            value: true
          },
          _showHeaderAnim: {
            type: Boolean,
            value: true
          },
          y: {
            type: Number,
            value: 0,
          },
        };
      }

      static get observers() {
        return [
          '_routeChanged(route.*)',
          '_viewChanged(routeData.view)'
        ]
      }

      _hasToShowHeaderAnim() {
        console.log('[warp10-main] _hasToShowHeaderAnim', this.isOnTop, this._showHeaderAnim);
        return this.isOnTop && this._showHeaderAnim;
      }

      ready() {
        super.ready();
      }

      _routeChanged(changeRecord) {
        this._showHeaderAnim = false;
        this._scrollHandler();
        console.log('[warp10-main] Path changed!', changeRecord);
        if (changeRecord.path === 'route') {
          if ('' === changeRecord.value.path) {
            this.set('route.path', '/');
          }
          if ('/' === changeRecord.value.path) {
            this._showHeaderAnim = true;
          } else {
            this.isOnTop = false;
          }
        }
        this.path = changeRecord.value.path;
      }

      _scrollHandler() {
        this.y = window.pageYOffset;
        this.isOnTop = this.y <= 1 && this._showHeaderAnim;
      }


      _viewChanged(view) {
        console.log('[warp10-main] _viewChanged changed!', view);
        this._showHeaderAnim = view === 'landing';
      }
    }

    customElements.define(Warp10Main.is, Warp10Main);
  </script>
</dom-module>