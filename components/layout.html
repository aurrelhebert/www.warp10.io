<link rel="import" href="promise-polyfill/promise-polyfill-lite.html">
<link rel="import" href="./styles.html">
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="marked-element/marked-element.html">
<link rel="import" href="iron-ajax/iron-ajax.html">
<link rel="import" href="menu.html">
<script src="../js/prism.js"></script>
<dom-module id="warp10-layout">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"
          integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
          crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/js/prism.css">
    <style include="style-module">
      .nav .collapse, .nav .nav-link .nav {
        margin-left: 10px;
      }

      .nav .nav-link {
        max-width: 200px;
      }

      .nav .nav-link.active {
        font-weight: bold;
      }

      .nav .nav-link.active:before {
        content: '> ';
      }

      .main-container {
        margin-top: 100px;
      }

      [slot="markdown-html"] {
        font-size: 1.2em;
      }

      [slot="markdown-html"] p {
        text-align: justify;
        text-indent: 10px;
        font-size: 1.2em;
      }

      [slot="markdown-html"] h1, [slot="markdown-html"] h2, [slot="markdown-html"] h3, [slot="markdown-html"] h4 {
        text-indent: 0;
        margin-top: 1em;
      }

      [slot="markdown-html"] h1 {
        font-size: 3em;
        color: #ff9900;
      }

      [slot="markdown-html"] h2 {
        font-size: 2em;
        color: #ff9900;
      }

      [slot="markdown-html"] h3 {
        font-size: 1.5em;
      }

      #content {
        text-align: justify;
      }
    </style>
    <app-route
      route="{{route}}"
      pattern="/:md"
      data="{{routeData}}"></app-route>


    <template is="dom-if" if="{{route.path}}" restamp>
      <div class="container main-container" id="main-container">
        <iron-ajax
          auto
          url="[[getFile(route.path)]]"
          handle-as="json"
          on-response="_handleResponse"
          last-response="{{ajaxResponse}}"
          debounce-duration="300"></iron-ajax>
        <div class="row">
          <dom-if if="[[withMenu]]">
            <template>
              <div class="col-sm-3">
                <warp10-menu></warp10-menu>
              </div>
            </template>
          </dom-if>
          <div id="panel">
            <div class="container">
              <h1>[[title]]</h1>
              <p>[[desc]]</p>
              <div id="content"></div>
            </div>
          </div>
        </div>
      </div>
    </template>
  </template>
  <script>
    class Warp10Layout extends Polymer.Element {
      static get is() {
        return 'warp10-layout'
      }

      static get properties() {
        return {
          withMenu: {
            type: Boolean,
            value: false,
          }
        }
      }

      _handleResponse(event, ironRequest) {
        event.stopPropagation();
        this.root.querySelector('#content').innerHTML = ironRequest.response.content;
        this.title = ironRequest.response.title;
        this.desc = ironRequest.response.desc;
        this.root.querySelectorAll('code').forEach(function (element) {
          Prism.highlightElement(element, false, function (r, e) {
            console.log('[warp10-layout] _renderComplete', r, e);
          });
        });
        this.root.querySelector('#panel').classList.add(this.withMenu ? 'col-sm-9' : 'col-sm-12');
      }

      getFile(path) {
        let spath = path.split('/');
        let md = 'raw';
        spath.slice(1).forEach(function (p) {
          md += '/' + p;
        });
        console.log('[warp10-layout] - getFile', md + '/raw.json');
        return md + '/raw.json'
      }

      _stringify(obj) {
        return JSON.stringify(obj);
      }
    }

    customElements.define(Warp10Layout.is, Warp10Layout);
  </script>
</dom-module>