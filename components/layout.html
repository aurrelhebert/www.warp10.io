<link rel="import" href="./styles.html">
<link rel="import" href="polymer/polymer.html">
<link rel="import" href="marked-element/marked-element.html">
<link rel="import" href="menu.html">
<script src="../js/prism.js"></script>
<dom-module id="warp10-layout">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"
          integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
          crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/js/prism.css">
    <style include="style-module">
      .nav .collapse, .nav .nav-link .nav {
        margin-left: 10px;
      }

      .nav .nav-link {
        max-width: 200px;
      }

      .nav .nav-link.active {
        font-weight: bold;
      }

      .nav .nav-link.active:before {
        content: '> ';
      }

      .main-container {
        margin-top: 100px;
      }

      [slot="markdown-html"] {
        font-size: 1.2em;
      }

      [slot="markdown-html"] p {
        text-align: justify;
        text-indent: 10px;
        font-size: 1.2em;
      }

      [slot="markdown-html"] h1, [slot="markdown-html"] h2, [slot="markdown-html"] h3, [slot="markdown-html"] h4 {
        text-indent: 0;
        margin-top: 1em;
      }

      [slot="markdown-html"] h1 {
        font-size: 3em;
        color: #ff9900;
      }

      [slot="markdown-html"] h2 {
        font-size: 2em;
        color: #ff9900;
      }

      [slot="markdown-html"] h3 {
        font-size: 1.5em;
      }
    </style>
    <app-route
      route="{{route}}"
      pattern="/:md"
      data="{{routeData}}"></app-route>
    <template is="dom-if" if="{{route.path}}" restamp>
      <div class="container main-container" id="main-container">
        <div class="row">
          <dom-if if="[[withMenu]]">
            <template>
              <div class="col-sm-3">
  <warp10-menu></warp10-menu>
              </div>
            </template>
          </dom-if>
            <div class="container" id="content">
              <marked-element disable-remote-sanitization on-marked-render-complete="_renderComplete">
                <div slot="markdown-html"></div>
                <script type="text/markdown" src="[[getFile(route.path)]]"></script>
              </marked-element>
            </div>
        </div>
      </div>
    </template>
  </template>
  <script>
    class Warp10Layout extends Polymer.Element {
      static get is() {
        return 'warp10-layout'
      }

      static get properties() {
        return {
          withMenu: {
            type: Boolean,
            value: false,
          }
        }
      }

      _getSize(withMenu) {
        let r = withMenu ? 'col-sm-9' : 'col-sm-12';
        console.log(r)
        return r;
      }

      _renderComplete() {
        console.log('[warp10-layout] _renderComplete');
        this.root.querySelectorAll('code').forEach(function (element) {
          Prism.highlightElement(element, false, function (r, e) {
            console.log('[warp10-layout] _renderComplete', r, e);
          });
        });
        this.root.querySelector('#content').classList.add(this.withMenu ? 'col-sm-9' : 'col-sm-12');
      }

      getFile(path) {
        let spath = path.split('/');
        if (spath[spath.length - 1] === '') {
          spath[spath.length - 1] = 'index';
        }
        let md = '';
        spath.slice(1).forEach(function (p) {
          md += '/' + p;
        });
        console.log('[warp10-layout] - getFile', md);
        return md + '.md'
      }

      _stringify(obj) {
        return JSON.stringify(obj);
      }
    }

    customElements.define(Warp10Layout.is, Warp10Layout);
  </script>
</dom-module>